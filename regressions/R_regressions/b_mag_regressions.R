# todo - read automatically data input from csv file
# DataAnalysis <- read.csv(file="b_mag.csv", header=TRUE, sep=",")
# x.knots <- c(20, 24, 26)
# fitting <- lm(DataAnalysis$b_image ~ bs(DataAnalysis$mag_iso, knots=x.knots))

# Manual data input
b_image <- c(1.6804112196, 1.0283267498, 1.6189316511200003, 1.5320327282,
             1.5513688325900001, 1.61706328392, 1.61239612103, 1.63057291508,
             1.59986019135, 1.56058514118, 1.5679428577399999, 1.63151955605,
             1.60765981674, 2.94201016426, 1.53861796856, 1.64676475525,
             1.6118786335, 1.67456007004, 1.69471645355, 1.67091715336,
             1.5472176075, 1.6187894344299998, 1.6434271335600001,
             1.55824184418, 1.61138653755, 1.60843634605, 1.67082643509,
             1.64307975769, 1.60142707825, 1.6862722635299998, 1.59729206562,
             1.62285912037, 1.65585255623, 1.6095452308700002, 1.73052144051,
             1.63637077808, 1.66225802898, 1.62567770481, 1.6650679111500002,
             1.6059041023299998, 1.60899984837, 1.6018040180200002,
             1.63479781151, 1.68463253975, 1.6437281370200003, 1.68310856819, 1.6318799257299998, 1.5342372655899998, 1.51673841476, 1.69230270386, 1.6612899303400002, 1.6335501670800001, 1.59822547436, 1.60769069195, 1.6672719717, 1.6729772090900001, 1.5412256717700001, 1.68685078621, 1.61135232449, 1.5422227382700002, 1.8955556154299997, 1.7140474319499999, 1.6346727609600002, 1.6691036224399998, 1.87302577496, 1.5205171108200002, 1.59916293621, 1.58513498306, 1.6599205732299998, 1.1691801548, 1.6499629020700002, 0.79763674736, 1.67052435875, 1.47515439987, 1.67457818985, 1.81847429276, 1.7747730016699999, 0.569982230663, 1.62471854687, 1.5997039079700002, 1.5831532478299999, 1.65985870361, 1.6512805223500002, 1.50150895119, 1.64002358913, 1.96038985252, 1.67385363579, 1.5645325183899998, 1.5999978780700002, 1.61402881145, 1.66561174393, 1.67727255821, 2.358543396, 1.63368463516, 1.6398150920899999, 1.6808409690900001, 1.6898869276, 1.6076524257700002, 1.6583032608000001, 1.6718250513100001, 1.5532897710799998, 1.5311797857299998, 1.58102464676, 1.6555901765799999, 1.6792576313, 1.22469139099, 0.570306658745, 0.5700407624239999, 1.66413390636, 1.58569216728, 1.8226237297099999, 1.5951859950999998, 1.64066195488, 1.5576820373500002, 1.6496313810299998, 1.90717983246, 1.53624844551, 1.53934061527, 1.5836327075999999, 1.8611383438099998, 1.61147868633, 1.69100737572, 1.66213643551, 1.65843629837, 1.68543362617, 0.494304120541, 1.59832131863, 0.493002444506, 1.57236361504, 1.5814261436500001, 1.72014153004, 1.6303112506900002, 1.68898129463, 1.66995286942, 1.66447734833, 2.7722513675700005, 1.64105951786, 1.6150104999500001, 1.6816341877, 1.6698275804499998, 1.68478679657, 1.65834093094, 1.47708165646, 1.76189148426, 1.70058560371, 1.5457890033700001, 1.41886711121, 1.46880269051, 0.843888282776, 1.7233926057799998, 1.51564276218, 1.43247580528, 1.45400893688, 1.45501077175, 1.46724426746, 1.43826460838, 1.45992326736, 1.4467124938999998, 1.47875094414, 1.3950676918, 1.66252696514, 1.5443210601800001, 1.50084137917, 1.4560453891799998, 1.52940642834, 1.4469435215000002, 1.47976827621, 1.5269429683700002, 1.43459260464, 1.4045158624599998, 1.5089725256, 1.50144600868, 1.42303645611, 1.5606532096899999, 1.4782344102899998, 1.40623486042, 1.55341684818, 1.48402309418, 1.41849160194, 1.4583646059, 1.46001172066, 1.37333226204, 1.42007136345, 1.46126973629, 1.4788398742700002, 1.49436974525, 1.4716620445299997, 1.56735551357, 1.43183386326, 1.4895521402399998, 1.4798592329, 1.48441195488, 1.44730830193, 1.46857357025, 1.51380181313, 1.44237470627, 1.4710055589700002, 1.4951941967, 1.4875099659, 1.45242202282, 1.5201842784900002, 1.51426231861, 1.50371658802, 1.43984770775, 1.4168694019299999, 1.54404127598, 1.58525848389, 1.4558731317500002, 1.51360452175, 1.47004103661, 1.51122093201, 1.77272987366, 1.79572296143, 1.42591607571, 1.46186828613, 0.583108007908, 1.42729711533, 3.7799739837599997, 1.4789428710899999, 1.44567835331, 1.4203295707700003, 1.45079910755, 1.53709030151, 0.82037460804, 1.4952911138499998, 1.50535321236, 1.4754683971399998, 1.44897592068, 1.50123715401, 1.4393228292500002, 1.41636896133, 1.45981907845, 1.55497682095, 1.50250673294, 1.46129512787, 1.44567668438, 1.51229059696, 1.5489065647100002, 1.40741038322, 1.49672043324, 1.479773283, 1.4652197361000001, 1.48632347584, 1.52868270874, 1.48409497738, 0.9643473029140001, 1.46308648586, 1.47804892063, 1.47768175602, 1.5194791555399998, 1.65554904938, 1.4207344055200002, 1.50909173489, 1.5336033105899998, 1.55501770973, 1.48632276058, 1.47063100338, 1.4647177457799998, 1.34537684917, 1.4669108390799999, 1.48144769669, 1.51902806759, 1.52385640144, 1.42283213139, 1.4457088708899999, 1.4721021652200001, 1.54142057896, 1.4311602115600002, 0.661901533604, 1.54382872581, 2.45653915405, 1.44377470016, 1.38353526592, 1.5107201337799998, 1.54310393333, 1.66902577877, 0.7869899868970001, 1.4658974409099998, 0.49963191151600006, 1.47282469273, 0.869299352169, 1.47762465477, 1.52348220348, 1.45816278458, 1.54016542435, 1.56598353386, 1.5571386814100001, 1.51874625683, 0.703101098537, 0.7413148283959999, 1.4323142766999999, 1.5032472610499998, 1.5398026704799999, 1.4589687585799997, 1.4664156436899998, 0.488453119993, 1.53478097916, 1.4866956472400001, 1.50128614902, 1.46070468426, 1.5207276344299998, 1.52737641335, 1.26440024376, 1.32669949532, 1.4210460186000002, 1.37915635109, 1.3417596817, 1.33287870884, 2.10468435287, 1.38014793396, 1.34566390514, 1.36483454704, 1.34382295609, 1.30410408974, 1.33966040611, 1.3691790103900001, 1.35705912113, 1.37715446949, 1.3787833452200002, 1.4964321851700002, 1.54870343208, 1.35138440132, 1.3864084482199999, 1.4543094635, 1.35365843773, 1.31389594078, 1.3919506072999999, 1.3966635465600001, 1.37782132626, 1.3891823291799998, 1.3553534746200002, 1.3336173296, 1.3717685937900002, 1.3456993103000001, 1.5652985572799998, 1.39489269257, 1.35485672951, 1.32799863815, 1.2993928194, 1.35222780704, 1.3496142625799998, 1.44663465023, 1.3263450861, 1.3964787721599998, 1.36750292778, 1.3614705801, 1.39039468765, 1.3498574495299998, 1.3464207649200002, 1.28656029701, 1.4883992672, 1.3628668785100002, 1.33437478542, 1.3185259103799998, 1.35354554653, 1.37370491028, 1.3499746322600001, 1.3428369760499999, 1.37747240067, 1.34675467014, 1.3425886631000001, 1.40734219551, 1.3456321954700001, 1.92231750488, 1.32768237591, 1.3747913837399999, 1.38773488998, 1.3578835725799998, 1.4111799001700003, 1.3574681281999998, 1.3721985817, 1.35281085968, 1.33316707611, 1.36314082146, 1.3285394906999999, 1.41374695301, 1.31394350529, 1.3040664196, 1.3376672267899998, 1.32495033741, 1.3790214061700001, 1.3839271068599999, 1.3739856481600001, 1.36134183407, 1.3697780370700001, 1.3235304355600002, 1.4001121521000002, 1.4189869165399998, 1.35806870461, 1.32045817375, 1.3689107894900001, 1.33476805687, 1.3869274854700002, 1.3709876537299999, 1.37917017937, 1.3665231466299999, 1.3432546853999998, 1.37726640701, 1.44300925732, 1.71188557148, 1.37640857697, 1.35170423985, 1.3977565765399997, 1.3661752939200003, 0.7388419508930001, 1.9796550273900002, 1.36179387569, 1.345277071, 1.39174723625, 1.31938195229, 1.3883502483399999, 1.38105630875, 1.3300201892899999, 1.32138562202, 0.66852915287, 1.3492568731299999, 1.35568571091, 1.32316863537, 1.38197577, 1.3321475982700002, 1.28479766846, 1.38357186317, 1.12872934341, 1.3333758115799998, 1.38258397579, 1.40170526505, 1.4122107029, 1.4026057720200003, 1.39761149883, 1.37609219551, 1.3560833931, 1.4022326469400002, 1.3435765504799997, 1.44283699989, 1.4186714887600003, 1.42589259148, 1.3204058408700001, 1.3934177160299999, 1.3397731781, 1.4842534065200002, 1.2966783046700001, 1.3507575988799998, 1.3824118375799999, 1.4273600578299999, 1.23735225201, 1.21577429771, 1.29021954536, 1.30156159401, 1.19748663902, 1.36905658245, 1.16812944412, 1.19489049911, 1.25613021851, 1.1668200492899998, 1.2457591295200001, 1.23388969898, 1.24140059948, 1.24934637547, 1.32529401779, 1.24703037739, 1.30939698219, 1.13738048077, 1.27538275719, 1.27277684212, 1.2143727541, 1.18821287155, 1.22639346123, 1.1865119934100001, 1.2778394222299998, 1.20852053165, 1.30149567127, 1.2608414888400001, 1.2067557573299998, 1.2915357351299999, 1.28604865074, 1.2883806228599999, 1.22607159615, 1.20129752159, 1.21000409126, 1.2232240438500002, 1.32730782032, 1.19251906872, 1.21140789986, 1.27491462231, 1.25666666031, 1.29154264927, 1.2136464118999999, 1.28838431835, 1.1661516428, 1.27381789684, 1.28537273407, 1.1959583759299999, 1.3571151494999998, 1.2360471487, 1.26261997223, 1.21308326721, 1.25336503983, 1.1714527606999998, 1.2173963785200002, 1.2950973510700001, 1.22812104225, 1.19016981125, 1.17581617832, 1.28695166111, 1.30244290829, 1.27083659172, 1.25526881218, 1.2677744627, 1.1656345129, 1.28020966053, 1.23257398605, 1.2965549230600002, 1.23674201965, 1.20070922375, 1.3242437839499999, 1.34781718254, 1.2874555587799998, 1.2894146442399999, 1.2130748033499998, 1.1931538581799999, 1.29097163677, 1.00690233707, 1.28579556942, 1.18893110752, 1.25637769699, 1.2523856163, 1.21617019176, 1.30106139183, 1.1803817748999998, 1.21518540382, 1.21835029125, 1.2562943697, 1.303399086, 1.29124069214, 1.23782134056, 1.1748675108, 1.26425457001, 1.18704926968, 1.22634506226, 1.24327421188, 1.30409932137, 1.24842262268, 1.2610384225799998, 1.29585385323, 1.25367808342, 1.17984974384, 1.29971396923, 1.2976694107100002, 1.2656596898999999, 1.17947566509, 1.2734361887, 1.24922084808, 1.29345703125, 1.32302463055, 1.23202419281, 1.2622563839, 1.23309648037, 1.30586290359, 1.30232739449, 1.41387653351, 1.3630077838899999, 1.21577107906, 1.2192504406, 1.19532859325, 1.29446065426, 1.25201177597, 1.23293495178, 1.25512218475, 1.2288210392, 1.2792557478, 0.994794011116, 1.06628370285, 0.513888776302, 1.23457074165, 1.15426456928, 1.03298056126, 1.04322290421, 1.1641651392, 1.05916833878, 1.0901284217799998, 1.0977007150700002, 1.0516132116299999, 1.08191525936, 1.12748861313, 1.05961561203, 1.18658745289, 1.19239354134, 1.0524146556899998, 1.1299792528200001, 1.20054137707, 1.06966292858, 1.08889555931, 1.1338157653799998, 1.0807254314399999, 1.07768261433, 1.1096470356, 0.9660980105399999, 1.01777625084, 1.0438264608399999, 1.14045143127, 1.2609219551100002, 0.985119104385, 1.0920493602799999, 1.05581951141, 1.0222020149200002, 1.07562434673, 1.08684301376, 1.1575762033499999, 1.16710031033, 1.00437259674, 1.0868867635700001, 1.08942365646, 1.01356875896, 1.11705756187, 1.31835114956, 1.12213051319, 1.10524082184, 1.1542408466299998, 1.0108319521, 1.0925024747799998, 1.1047921180700002, 1.0836808681499999, 1.15222048759, 0.938790798187, 1.06083750725, 1.07249796391, 1.06927120686, 0.9207836389540001, 1.09154212475, 1.01836752892, 1.00611007214, 1.07961702347, 1.12389814854, 1.0385541915899998, 1.01075315475, 0.952965438366, 1.0527381896999999, 1.3200933933299999, 1.1161965131799998, 1.0649089813200001, 0.9857993721960001, 1.02442800999, 1.19244480133, 1.01517724991, 1.1704483032200002, 1.0924036502799999, 1.08854222298, 1.0515424013099999, 1.04085886478, 0.944941878319, 1.11767244339, 1.12855780125, 1.16712450981, 1.18047428131, 1.07504177094, 1.0012494325599999, 1.10823857784, 1.16183245182, 1.11709177494, 1.0537071228000001, 1.09534108639, 1.1243422031399999, 1.38084864616, 0.513775467873, 1.0258619785299998, 1.08065736294, 1.08618783951, 1.12052464485, 1.1008174419399999, 0.960161149502, 1.0262196064, 1.1452611684799998, 1.17301928997, 1.1667025089299998, 1.16003918648, 1.1324827671100002, 1.05031347275, 0.955629050732, 1.11048984528, 1.20259940624, 1.04461812973, 1.12329745293, 1.09130811691, 1.0563031434999999, 1.06827163696, 1.0876840353, 1.0551892519, 1.20759606361, 1.21706485748, 1.13909339905, 1.05794477463, 1.0549523830399998, 1.13825798035, 1.1006952524200002, 1.15364325047, 0.9744035005570001, 1.18746328354, 1.07320964336, 1.0898419618600002, 1.1751995086700002, 1.09699165821, 1.04088056087, 0.776882171631, 1.1090682745, 0.966817736626, 0.6812293529510001, 0.760491371155, 0.757184386253, 0.949854373932, 0.8287109732629999, 0.9258147478100001, 0.9518795013429999, 0.985055088997, 0.73750180006, 0.8474876880650001, 0.783976554871, 0.835433423519, 0.8681637644769999, 0.737728357315, 0.919835984707, 0.889283299446, 0.9777133464810001, 0.9446369409559999, 0.834503650665, 0.9303448200229999, 0.7166380882260001, 0.786823868752, 0.743913888931, 0.7643502950669999, 0.687748253345, 0.917431473732, 0.897262334824, 0.7484062314030001, 0.741535425186, 1.00265717506, 0.7267744541169999, 0.879033386707, 0.905561029911, 0.825132906437, 0.8554660081859999, 0.737402617931, 0.915224969387, 0.777625918388, 0.719480395317, 0.9650058746340001, 0.926719844341, 0.829016685486, 0.960005879402, 0.7824834585189999, 0.940495610237, 0.907402634621, 0.7743271589280001, 0.742593169212, 0.7907625436779999, 0.840663731098, 0.897083580494, 0.736405789852, 0.958911299706, 0.762593328953, 0.91839492321, 0.8306000232699999, 0.8884865045550001, 0.850848257542, 0.798541784286, 0.824390769005, 0.810291647911, 0.814585745335, 0.844590544701, 0.723830640316, 0.9160416126250001, 0.724132657051, 0.800698101521, 0.900027632713, 0.836921095848, 0.8272910714149999, 0.8220332264899999, 0.953899860382, 0.993755221367, 0.718176960945, 0.740980923176, 0.8944295644760001, 0.8319417834280001, 0.9276198744769999, 0.8852100372310001, 0.727041959763, 0.808410644531, 0.835505664349, 0.986388146877, 0.927343964577, 1.0131980180700002, 0.869480252266, 0.780777692795, 1.0908448696100002, 0.7372593879699999, 0.921781539917, 0.7348932623860001, 0.828858315945, 0.959414362907, 0.728013753891, 0.722376763821, 0.771865308285, 0.815250277519, 0.884512603283, 1.00260877609, 0.705533802509, 0.836415171623, 0.922663033009, 0.753009438515, 0.894866466522, 1.02165138721, 0.913198709488, 0.943475663662, 0.8592675924299998, 0.813666880131, 0.8940399885179999, 0.750713050365, 0.7454829216, 0.893177986145, 0.8092761039730001, 0.52687305212, 0.6440296173100001, 0.918386220932, 0.7028204798700001, 0.681494534016, 0.6513121128079999, 0.656679153442, 0.571271896362, 0.586016058922, 0.628920435905)
mag_iso <- c(20.2024478912, 25.0718975067, 20.508678436300002, 20.7549724579, 20.9519519806, 20.5658721924, 20.6051368713, 20.3368263245, 20.7349452972, 20.9674930573, 20.9595146179, 20.6883201599, 20.6175918579, 20.1768875122, 20.6987266541, 20.402614593499997, 20.6092147827, 20.202960968, 20.606176376300002, 20.6859912872, 20.9494400024, 20.602306366, 20.6102924347, 20.9619464874, 20.6052951813, 20.8771629333, 20.2119102478, 20.574831008900002, 20.5317001343, 20.1480178833, 20.7173080444, 20.5098495483, 20.2215881348, 20.6708755493, 20.2695846558, 20.404985427899998, 20.3627662659, 20.5003604889, 20.3030281067, 20.565454483, 20.6062374115, 20.873714447, 20.6392402649, 20.544090270999998, 20.581850051900002, 20.202732086199997, 20.6185054779, 20.8798065186, 20.9215431213, 20.3087062836, 20.230171203599998, 20.462116241500002, 20.7333660126, 20.592376709, 20.506772995, 20.4044704437, 20.6185073853, 20.5967216492, 20.6100502014, 20.8846168518, 20.5459632874, 20.5888366699, 20.3240470886, 20.2289619446, 20.5247821808, 20.8941249847, 20.9346790314, 20.6960906982, 20.4986686707, 25.103439331100002, 20.3250999451, 25.974481582600003, 20.2029647827, 24.877363205, 20.2092247009, 24.217485427899998, 23.7166423798, 27.0864048004, 20.720485687300002, 20.4460678101, 20.6868972778, 20.3735694885, 20.4678878784, 20.9715003967, 20.381729126, 24.1388244629, 20.3178062439, 20.7349033356, 20.5891399384, 20.4980888367, 20.6876411438, 20.2165126801, 20.57995224, 20.5066661835, 20.5611000061, 20.2158279419, 20.6661567688, 20.5099182129, 20.5676574707, 20.3224391937, 20.90675354, 20.6159915924, 20.8798294067, 20.205749511700002, 24.501457214400002, 24.967519760100004, 26.7831192017, 26.4819736481, 20.2348766327, 20.9269237518, 20.3866844177, 20.614107132, 20.2026405334, 20.9683303833, 20.3662185669, 24.0899658203, 20.5860080719, 20.6381950378, 20.7442588806, 20.8011245728, 20.7190341949, 20.501239776600002, 20.3987579346, 20.3280277252, 20.2183685303, 27.2865314484, 21.0033130646, 26.217382431, 20.9788703918, 20.8855419159, 20.367612838699998, 20.8839874268, 20.2132034302, 20.5965366364, 20.5703964233, 20.762008667, 20.5939044952, 20.9129505157, 20.319213867200002, 20.5687999725, 20.1524066925, 20.569353103599997, 24.553121566799998, 20.175613403299998, 20.503774642899998, 20.614402770999998, 21.933324813800002, 21.737211227399996, 25.894123077399996, 21.0674057007, 21.317878723099998, 21.672533035300003, 21.5203285217, 21.570600509600002, 21.539192199699997, 21.9518013, 21.6776790619, 21.909275054899997, 21.4400253296, 21.9600067139, 21.1767234802, 21.1839370728, 21.4556064606, 21.5342082977, 21.107246398900003, 21.6533546448, 21.0737075806, 21.1154251099, 21.659379959099997, 21.9612312317, 21.2149829865, 21.2211399078, 21.9224853516, 21.8981742859, 21.3613204956, 21.710037231399998, 21.322412490799998, 21.493957519499997, 21.898824691799998, 21.5346279144, 21.2361431122, 21.984100341799998, 21.9510993958, 21.547548294099997, 21.4675331116, 21.2203903198, 21.5088443756, 21.205083847, 21.919668197600004, 21.4214076996, 21.5958461761, 21.3466205597, 21.5324211121, 21.6627388, 21.4331436157, 21.6507225037, 21.2534427643, 21.2195987701, 21.354347229000002, 21.5870056152, 21.2353668213, 21.225542068499998, 21.221496582, 21.6908683777, 21.894105911300002, 21.319190979000002, 21.0929603577, 21.4000205994, 21.1031532288, 21.2172584534, 21.4309196472, 21.548278808600003, 21.180795669600002, 21.935436248800002, 21.5266971588, 26.8089904785, 21.4400501251, 21.754293441799998, 21.519842147800002, 21.832456588699998, 23.8226490021, 21.6463432312, 21.2192745209, 26.286567688, 21.585020065300004, 21.2235183716, 21.5373916626, 21.5751972198, 21.512964248699998, 21.691379547100002, 21.940090179400002, 21.613130569499997, 21.1863269806, 21.2382507324, 21.472707748399998, 21.5148601532, 21.221244812000002, 21.049057006800002, 21.9418067932, 21.1279773712, 21.2326450348, 21.340921402, 21.4556999207, 21.222707748399998, 21.4648551941, 25.7135543823, 21.4127788544, 21.6592712402, 21.36510849, 21.1967506409, 24.922424316399997, 21.956338882399997, 21.1217899323, 21.4601669312, 21.2193756104, 21.417882919300002, 21.4588546753, 21.551574706999997, 24.309469223, 21.898029327399996, 21.4516735077, 21.3208007812, 21.3482513428, 21.744323730500003, 21.5267524719, 21.5721740723, 21.5360507965, 21.6845417023, 26.4604988098, 21.817527770999998, 22.9042053223, 21.6704998016, 21.9969100952, 21.2328643799, 21.4188709259, 24.193107605, 26.1828594208, 21.2579841614, 27.303647995, 21.226299285899998, 26.274250030500003, 21.4773788452, 21.406452179000002, 21.6746711731, 21.508327484099997, 21.34765625, 21.4654846191, 21.2302474976, 26.8638744354, 25.7063045502, 21.7414894104, 21.2287750244, 21.1199512482, 21.5869064331, 21.9234962463, 26.479619979899997, 21.523443221999997, 21.440727233900002, 21.3356342316, 21.959318161, 21.4461994171, 21.5096664429, 24.1233596802, 22.800403595, 22.301259994499997, 22.5401916504, 22.594783783, 22.8146133423, 23.8300132751, 22.762266159099998, 22.806482315100002, 22.568363189699998, 22.534189224200002, 22.954895019499997, 22.8241767883, 22.275979995700002, 22.549530029299998, 22.2825889587, 22.537309646599997, 22.279272079499997, 22.089553833000004, 22.665885925300003, 22.1735954285, 22.236787795999998, 22.679731369000002, 22.968585968000003, 22.7742214203, 22.142024993899998, 22.4332866669, 22.246629715, 22.5187511444, 22.8070869446, 22.4572963715, 22.5900859833, 22.7803916931, 22.187343597399998, 22.4308052063, 22.86668396, 22.980707168600002, 22.5130672455, 22.432773590100002, 22.930932998699998, 22.836172103899997, 22.163324356100002, 22.5302047729, 22.665676116900002, 22.2608947754, 22.412616729699998, 22.523513793899998, 22.8867301941, 22.4517765045, 22.5889835358, 22.6283111572, 22.9727249146, 22.7609577179, 22.590429306, 22.803684234600002, 22.636796951300003, 22.737539291399997, 22.539300918600002, 22.7060375214, 22.297462463400002, 22.5522880554, 22.3084506989, 22.797740936300002, 22.1657009125, 22.522226333600003, 22.7328014374, 22.5047988892, 22.4670963287, 22.2876796722, 22.319061279299998, 22.6930999756, 22.5843677521, 22.9625930786, 22.128086090100002, 22.879299163800003, 22.9245815277, 22.8449764252, 22.5189247131, 22.451389312699998, 22.7931632996, 22.4236335754, 22.4599971771, 22.491430282600003, 22.811708450300003, 22.270204544099997, 22.5205287933, 22.5496425629, 22.6203994751, 22.412464141799997, 22.5456886292, 22.1864871979, 22.2949066162, 22.52709198, 22.274490356399998, 22.6992759705, 22.2931213379, 22.2791252136, 23.9230422974, 22.418056488, 22.5671768188, 22.1881065369, 22.241012573200003, 26.0471954346, 23.7793388367, 22.5548095703, 22.661407470700002, 22.2800445557, 22.9764614105, 22.2901268005, 22.788585662800003, 22.6826095581, 22.947324752800004, 26.5379123688, 22.4412727356, 22.8057556152, 22.7961406708, 22.534587860100004, 22.8622512817, 23.0748596191, 22.1289253235, 24.8610477448, 22.8159008026, 22.464363098099998, 22.450014114400002, 22.162418365500002, 22.8347091675, 22.325847625700003, 22.8602161407, 23.007785797100002, 22.3963775635, 22.6889686584, 22.8191261292, 22.184539794899997, 22.275747299200003, 22.5663375854, 22.6080265045, 22.9864006042, 22.426071166999996, 22.6271152496, 22.783561706500002, 22.5680923462, 22.2324085236, 23.378692627, 23.8188095093, 23.1723690033, 23.331357955900003, 23.8826065063, 23.3102798462, 24.081325530999997, 23.9829807281, 23.1571426392, 24.014394760100004, 23.6313304901, 23.8946228027, 23.630119323699997, 23.48046875, 23.2214126587, 23.7147102356, 23.148082733200003, 23.979372024499998, 23.359594345100003, 23.5920944214, 23.5757522583, 23.9927253723, 23.9524612427, 23.930740356399998, 23.2798957825, 23.961874008200002, 23.2549514771, 23.625547409099998, 23.8660240173, 23.154079437300002, 23.440006256100002, 23.9595298767, 23.597269058200002, 23.8983955383, 23.833152770999998, 23.604619979899997, 23.107069015500002, 23.9061660767, 23.7119636536, 23.2607898712, 23.3964157104, 23.3728256226, 23.6063919067, 23.2666358948, 23.862926483200003, 23.2203655243, 23.2754478455, 23.927394866900002, 23.067024230999998, 23.742891311599998, 23.6065864563, 23.7845153809, 23.632053375199998, 24.000358581500002, 23.796728134200002, 23.3872470856, 23.749465942399997, 23.891910553000002, 23.9599838257, 23.2741165161, 23.2915344238, 23.2915554047, 23.712482452399996, 23.931365966799998, 23.909587860100004, 23.1901359558, 23.460842132600003, 23.1754016876, 23.710723877, 23.8072757721, 23.1294002533, 23.1579742432, 23.372970581100002, 23.5796070099, 23.899353027300002, 23.9705410004, 23.2768726349, 25.9664287567, 23.6419773102, 23.9556331635, 23.3947029114, 23.324214935300002, 23.5667667389, 23.2247142792, 23.9178695679, 23.849998474099998, 23.653100967399997, 23.376625061, 23.2827529907, 23.5619773865, 23.783298492399997, 23.9695358276, 23.597578048699997, 23.9745769501, 23.9345817566, 23.3261852264, 23.253578186, 23.625316619899998, 23.622497558600003, 23.402185440100002, 23.691101074200002, 23.9960784912, 23.991170883200002, 23.144454956100002, 23.4685344696, 23.812030792199998, 23.271753311199998, 23.362443924, 23.1302604675, 23.2840003967, 23.9134883881, 23.701908111599998, 23.9014854431, 23.1519050598, 23.2850513458, 23.1865367889, 23.179592132600003, 23.912624359099997, 23.9766197205, 23.899057388299997, 23.361701965300004, 23.984664916999996, 23.7980632782, 23.977703094499997, 23.6597442627, 23.2437057495, 25.024570465100002, 24.7780227661, 27.017225265500002, 24.3946723938, 24.1536064148, 24.614109039299997, 24.9304409027, 24.2495594025, 24.8559074402, 24.6689777374, 24.458318710300002, 24.856889724699997, 24.3310432434, 24.126754760700003, 24.890056610100004, 24.302272796599997, 24.343826293899998, 24.6766204834, 24.635900497399998, 24.1784553528, 24.531433105500003, 24.5509147644, 24.415845871, 24.707340240500002, 24.636445999099998, 24.647333145100003, 24.8396835327, 24.9570236206, 24.6424789429, 24.1377830505, 24.4458732605, 25.044681549099998, 24.4319343567, 24.6257286072, 24.9921741486, 24.3198184967, 24.531381607100002, 24.3093109131, 24.1912689209, 24.998979568499998, 24.566019058200002, 24.5444850922, 24.8705825806, 24.540954589800002, 24.458011627199998, 24.474264144899998, 24.8197517395, 24.2139549255, 24.947845459, 24.373331069899997, 24.3280181885, 24.675857543899998, 24.2266788483, 25.2152996063, 24.6106109619, 24.6823692322, 24.599925994899998, 24.7865028381, 24.6301250458, 24.8964862823, 24.9008636475, 24.7510490417, 24.315334320100003, 24.862728118899998, 24.9276332855, 25.0441608429, 24.908088684099997, 24.205709457399998, 24.3547153473, 24.5888557434, 24.9384040833, 24.3908691406, 24.252080917399997, 24.7725830078, 24.5065002441, 24.7116565704, 24.6169071198, 24.8052978516, 24.8042469025, 25.0380325317, 24.1977882385, 24.2001953125, 24.128389358499998, 24.249711990399998, 24.5277290344, 25.0048332214, 24.2553863525, 24.2484664917, 24.4029445648, 24.6542339325, 24.700853347800003, 24.547861099200002, 24.7526626587, 26.800041198699997, 24.9137802124, 24.312789916999996, 24.5809135437, 24.343477249099998, 24.405384063699998, 25.0766773224, 24.969461441, 24.2638435364, 24.144294738800003, 24.2762145996, 24.385761261, 24.6681957245, 24.7571678162, 25.1709804535, 24.6432914734, 24.2767429352, 24.8059978485, 24.651706695599998, 24.6087188721, 24.643396377600002, 24.944259643600002, 24.9901828766, 24.888471603400003, 24.203031539899996, 24.1228313446, 24.5230178833, 24.7907657623, 24.8688049316, 24.575750351, 24.763576507600003, 24.6138725281, 24.8207798004, 24.219165802, 24.6604366302, 24.9486198425, 24.4390621185, 24.439119339, 24.716342926, 26.308097839400002, 24.3591861725, 25.247287750199998, 26.114385604899997, 26.0078983307, 25.9086437225, 25.4240837097, 25.7083930969, 25.4854774475, 25.274787902800004, 25.2662811279, 26.0408401489, 25.8365497589, 25.9980621338, 25.6717338562, 25.6880092621, 26.000318527199997, 25.339382171599997, 25.3780517578, 25.2587203979, 25.323211669899997, 25.6930465698, 25.352706909200002, 26.1374835968, 25.9846820831, 25.9577140808, 26.0854320526, 26.1179733276, 25.3900604248, 25.6074867249, 26.0476741791, 25.9665527344, 25.622274398800002, 25.9088993073, 25.6125545502, 25.595428466799998, 25.929262161300002, 25.7509536743, 25.940942764299997, 25.500120163000002, 25.8367729187, 25.96900177, 25.4233341217, 25.5120391846, 25.450778961199997, 25.5452346802, 26.033874511700002, 25.386240005500003, 25.361402511599998, 26.0166854858, 25.957126617399997, 25.965166091900002, 25.9071083069, 25.4952430725, 26.1543426514, 25.2609348297, 25.8655853271, 25.7376670837, 25.7130813599, 25.353698730500003, 25.7419071198, 25.9089164734, 25.8324680328, 25.938356399499998, 25.5154018402, 26.1145706177, 26.1436729431, 25.3748092651, 26.0250778198, 25.890056610100004, 25.5661468506, 25.7629966736, 25.651565551799997, 25.5365505219, 25.2456970215, 25.1196975708, 25.9841594696, 26.0615253448, 25.4966049194, 25.923162460300002, 25.2534141541, 25.590461730999998, 26.077037811300002, 25.8065357208, 26.001796722399998, 25.3537082672, 25.3043403625, 25.437704086300002, 25.646686554000002, 26.0923576355, 24.909732818600002, 25.9802589417, 25.401515960700003, 26.0000896454, 25.6055679321, 25.1845817566, 26.1056022644, 26.1695919037, 25.9613742828, 25.8905601501, 25.6607704163, 25.1644802094, 26.321132659899998, 25.6710700989, 25.6213035583, 25.9717216492, 25.644294738800003, 25.0968227386, 25.5699825287, 25.350818634, 25.8643741608, 25.8004512787, 25.5746154785, 25.6257476807, 26.077388763400002, 25.6472454071, 26.107810974099998, 26.5497570038, 26.296691894499997, 25.968460083000004, 25.9840831757, 26.3870010376, 26.5108280182, 26.5960235596, 26.271945953400003, 26.5233745575, 26.4638175964)

# Second method
# x.knots <- c(21)
# fitting_2 <- lm(b_image ~ bs(mag_iso, knots = x.knots))
# # fitting_2 <- lm(b_image ~ mag_iso)
# print(summary(fitting_2))  # Prints fit information
# 
# plot(mag_iso, b_image)
# # plot(fitting_2, which = c(1,6))  # Diagnostic plots
# 
# xmin <- min(mag_iso)
# xmax <- max(mag_iso)
# x.predict <- seq(from = xmin, to = xmax, length.out=829)
# y.predict <- predict(fitting_2, newdata = data.frame(x = x.predict))
# lines(mag_iso, y.predict, col="red", lwd=2)
# 
# abline(v = x.knots, lty = 2, col = "grey")  # knots position

adaptive.splines <- function(n.knots, n.maxit=500) {
  xmin <- min(mag_iso)
  xmax <- max(mag_iso)
  delta <- 1 / (n.knots + 1)
  x.knots <- quantile(seq(xmin, xmax, length.out = 1000), 
                      probs=seq(delta,1-delta,length.out=n.knots))
  names(x.knots) <- NULL
  ajuste.inicial <- lm(b_image ~ ns(mag_iso, knots=x.knots))
  
  # plot de ajuste inicial
  old.par <- par(mfrow=c(1,2))
  plot(mag_iso, b_image, pch=21, bg="grey", xlab="X", ylab="Y",
       main=paste("Initial fit (",n.knots,"knots)",sep=""))
  xp <- seq(xmin,xmax,length.out=1000)
  yp <- funp1p2(xp)
  lines(xp,yp,col="blue") # función generadora
  plot.ajuste(xmin,xmax,x.knots,ajuste.inicial)
  solution <- optim(x.knots, fun.to.minimize, control=list(maxit=n.maxit))
  cat("\n* Number of iterations:",solution$counts[1],"\n")
  ajuste.final <- lm(y.with.noise~ns(x,knots=solution$par))
  plot(mag_iso, b_image, pch=21, bg="grey", xlab="X", ylab="Y",
       main=paste("Final fit (",n.knots," knots)",sep=""))
  lines(xp,yp,col="blue") # función generadora
  plot.ajuste(xmin,xmax,solution$par,ajuste.final)
  par <- old.par
  print(data.frame(initial.knots=round(x.knots,3),final.knots=solution$par))
  cat("--> Sum(residuals^2) initial fit:",sum(ajuste.inicial$residuals^2),"\n")
  cat("--> Sum(residuals^2) final fit:",sum(ajuste.final$residuals^2),"\n")
  # retorna resultado del ajuste
  return(list(ajuste=ajuste.final, niter=solution$counts[1]))
}

adaptive.splines(4, 20)